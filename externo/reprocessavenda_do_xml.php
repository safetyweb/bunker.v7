<?php
// Definir cabeçalho HTTP para UTF-8
header('Content-Type: text/html; charset=utf-8');


$array=[['09FB18E0-1C86-478B-972B-B2FD362F172E-4','4356685873'],
['45CB9747-3B8A-4B77-9358-5492281DD2C3-4','21304890872'],
['5FD209BE-574F-4D64-80A5-AF364884DC17-3','75684250882'],
['5D8F839B-BC7C-44FC-9E91-9F0E73C0ED6C-7','84151218815'],
['0D24BE17-35C0-4F24-AA21-715EB10F0ECA-3','1712416812 '],
['2D9900D1-5298-440F-B84C-1AD8B4BF9C24-4','5502166856 '],
['2362A586-0BA4-429D-8821-9B14DBFBD291-3','13008929869'],
['49D1A40F-EB75-418D-A84E-0D9B12DFDA31-3','30975028820'],
['86DDF49A-7361-4260-B8BF-3ACAC297341C-2','94704619834'],
['56EE7B78-FB47-4918-A858-2857827FC8FE-4','97680443653'],
['EA72B206-2305-4DFA-9B04-3EF02AA524BA-4','81057830887'],
['407B7442-5EFF-4E98-B064-22003D4DF2D9-4','8667563889 '],
['660328F8-D74E-4B37-B49E-9D24A9EE31DB-4','10123585856'],
['6E085F97-5BCE-468D-B49A-E4B088E35413-5','3805000863 '],
['0A1B578C-C466-406F-AAAF-04CC43EA35BE-2','9220923890 '],
['04FEADE7-EB80-4C13-A719-1B78CE72B445-4','25807184866'],
['B8608AC0-CBFE-46C4-9152-BDEBA41B6228-3','14660764885'],
['53AABD5A-D02F-4B8C-8564-86A6B0A058CE-3','21295383802'],
['1E4B5334-7428-4733-A8FC-3B3D0BFB9450-5','84789140644'],
['8AE3EEFC-CC7A-4DD9-AB34-2A4282293453-7','29826066826'],
['8615767E-86EF-4CAF-B03E-464689B56C12-2','29060297857'],
['C8E5D137-F0F1-446E-94B7-E2AE202E7104-7','29645137837'],
['E326A98B-5B25-44A2-9B4B-53A00AD22212-4','31915364850'],
['268E789C-3132-4C64-81C8-481829BD217A-4','80591230844'],
['6E2661D9-78BE-4F81-97DF-04732D017D51-5','17030643801'],
['218BB19C-3C45-426F-92FA-88189461E042-4','975453840  '],
['7B5782F0-B2A4-4EDD-9FE8-EBE806F2BBC5-7','77821246891'],
['A2D87AC7-7C3F-4AD4-BE81-B87FFC3E34CB-4','14903727840'],
['EA003425-E701-43A5-AABF-4BCA5AE82B57-5','32099183848'],
['69266B0D-2EF6-4BA1-BA21-A0515477B5AE-4','12175978320'],
['17F3728D-26D1-4843-8015-D4B1EFF78B4E-7','4003672895 '],
['2E7625F0-6C41-4A03-AA0C-29EEE9BF1961-4','11033156841'],
['F13D4BDA-FFB0-401B-9758-AB33CF61C3D8-4','3184319806 '],
['4091ACD2-9DA6-4A05-9DDA-DC3C7BCB7B76-4','610077813  '],
['EDBDEC73-6596-4A23-89F7-B2CBCFC84161-7','27336218822'],
['6CD3D292-2524-4CBF-ADFF-D381C1C60541-5','7222209875 '],
['3FDB08D9-3A44-4669-AD3B-53AE7F0FB0E4-4','629067805  '],
['FD7B2DEF-E440-426F-AAC9-D3CC2056B571-5','11932998888'],
['E182A880-8F1D-4664-8674-E5BEC89792C7-4','10076283836'],
['DC5D8E75-EF6F-4A43-8864-6D91CED5FE80-2','4166274805 '],
['829DA6E1-1651-490A-8F5B-36F08B7B6A2A-5','29959976858'],
['AD3E06BC-3918-41FE-A2D3-20AA192E9BAF-5','16258391893'],
['03A8B90F-5F53-47C6-A838-26FE9EBF899B-5','25440460829'],
['D1432193-5C37-4C06-BB8F-2CF81A2BD512-7','26806641830'],
['5A5A57AE-261C-4693-8C36-9F387B502DDE-4','27126543824'],
['11E73AD9-5134-4405-9564-2121CBF52E97-3','5103735857 '],
['5C059135-0671-4467-95DE-9E85A7869711-5','15507615870'],
['95B08373-2C04-431B-8D04-89277601D222-2','51256185191'],
['612E1C0C-A2DC-4D0B-A7EC-7A3D853F7317-4','57801479815'],
['BF594396-BD5A-4EFA-AC9A-F60BDBC1A88C-3','9960009840 '],
['0BF61B83-0084-433A-AE25-8F6F9CA1CC89-5','17384470811'],
['3CCD7E2C-3D22-4271-8213-CBDAB38DA67D-2','16592394862'],
['01150ABE-F6D9-446E-85F2-C2B25AA404D8-3','7379942824 '],
['F08A029D-E12B-447F-A921-AB2BC6AE44F1-5','5864355810 '],
['EFC31D4A-CE3A-4F5D-8C96-B8610F5D906E-4','24949595865'],
['D6C67381-03CA-4B7D-AD20-B38F958CE60B-4','7541433845 '],
['813CA0C7-3E9D-4584-81AD-9379035A6F1B-4','13596970806'],
['B72D3857-71BF-4FE1-8FE1-D91234F30DFA-3','93842929820'],
['4CB46D43-5D72-4047-9228-CAF884C91D07-3','33658279869'],
['060333F1-81C2-407A-92B8-6EBF99149EC1-4','90509854834'],
['3B069C90-A588-4272-B554-ABC6F67D70AB-4','3083271875 '],
['C9145195-C13E-4647-A03F-8BD264B09692-4','25827823864'],
['0783A1FF-2291-43F0-B810-54DB0DEB67EF-7','25516085896'],
['26FA796A-764D-4F53-BA44-D1A13B698464-4','8559290818 '],
['0C9DE26F-8090-4828-BE5F-1F0045F5B5A0-4','3948469822 '],
['DD87616F-4856-433B-8D2E-9AB2D5E1B013-4','5344839847 '],
['2EF0573C-7434-4E29-B534-FCF81BE0A15A-7','69708100625'],
['023E2493-964F-47B9-B8C5-4A9B09894EF7-4','2974826881 '],
['9B861482-817C-4A95-85E5-C81AFE234DB0-7','4808768860 '],
['AC559F20-8A0C-473F-A95D-023E13C730E3-5','86536087887'],
['0CB22F69-1CD2-47CC-A50C-20F59A11FA13-5','97115827834'],
['52F38ECD-FEF5-4F26-ACB7-2BF206EDE321-2','33763206833'],
['038BC3C3-E6EE-4D52-B6DB-A981B002BA5E-4','57352259872'],
['C3A32100-0147-4B0F-A8DE-9AA9827D8DAD-7','40362841853'],
['95007501-DAFE-45B6-8F4C-08B41AC2CB96-3','30904886808'],
['BD2B723B-6E6D-42E0-9705-E3E0570F4210-3','15188020874'],
['190BDDEA-E99E-4392-A590-FC4A648D6460-5','4740761645 '],
['1E5D4CAD-9986-447C-A51C-9EC01574C4DD-4','26321163848'],
['386F4B71-5D5A-4132-9E8F-F40D5AB10515-4','1308943890 '],
['EA207F3F-5720-4F29-B361-A293EC855436-3','21392172845'],
['A8700DC5-6BDA-42B2-ACE9-2AB38CC1FD48-3','25484373883'],
['5901D548-41FB-4EBD-B368-FBA75122F73E-4','3164463863 '],
['70CD054F-4267-433D-9E63-B8C838335878-4','28258105841'],
['86D08CE7-5D47-461C-B194-5BDCBB66CFB1-4','8559290818 '],
['803CD168-7663-4F9B-9625-B8060AED6D1D-4','93398123872'],
['654F8462-FF38-4717-926F-57F2C5505D93-7','2195267887 '],
['8171DD06-6255-46B3-8181-B3F2FB3E2BFD-4','6622049807 '],
['9653AC5A-7956-4B93-A098-E1C14B391E12-2','6349592808 '],
['A775BA16-46F7-4FD4-A9C0-EDF237529806-2','8692720801 '],
['B3EB9FB0-74A3-4BA0-B0A6-CBAEBC08CB8F-3','3875237820 '],
['5686BE88-1D70-41F7-B65C-B76B21F936DA-7','6199524829 '],
['153C6BAE-1252-45CD-85A6-2647FD142E13-7','86662082872'],
['75B3DE3A-711C-4753-AB5D-7190B2EEFF23-3','5290426817 '],
['470CF684-E7EB-4665-9265-D1825E6D62FA-4','8708650802 '],
['DA486477-312F-48A3-8458-91CC17AFD154-4','3560574889 '],
['D8D2852B-7BB7-464D-A680-94F53FC7EF15-4','6357542822 '],
['83E1ADBF-8E5D-4662-80AC-A3E8E5594DA7-3','27810375830'],
['A57D056A-19FA-4755-9377-658E9D51CD05-3','6579654805 '],
['7858CA17-539F-47B3-974E-8B3B1CFC8E17-4','35503799860'],
['E8AADAAD-5444-4946-8E85-29D02CABFD35-2','89768019891'],
['93CCFDE0-4467-4596-B8E6-0F346E2A98B4-5','25786493830'],
['B8C19FAD-EC32-459B-99DD-E0CE4F058E07-5','8712188875 '],
['60F2617C-E621-4706-822F-D016B8F5ED9E-5','96273763887'],
['4303AECA-AFD6-44AA-8D8E-02D64C7C980B-2','96701129820'],
['36E369F6-380F-4432-AC67-6EEF9088C58B-2','3402284669 '],
['EC1AF035-AFD4-4330-A020-79CAC53A9BB7-2','5511283800 '],
['16A6595A-97AD-42FB-A841-820AFEAB6C45-2','11623526809'],
['034A2A38-BFAC-4950-B354-1203F9467F6E-2','9220923890 '],
['4EBD0FF6-651B-4CF5-95EE-9FB4F4F7FB80-4','15666465880'],
['E81A26A1-B7AE-4F5B-AE4C-4C108E2174F7-5','72133961887'],
['5612F5FF-2159-4680-9135-8C2AC5849723-5','15856279840'],
['1746D900-A1E7-4D5D-8C32-55C81EE4AB40-4','14905289890'],
['19745EE4-06F9-400D-B272-31CB95A82ED7-7','40362841853'],
['F0078E28-F247-4E4C-A41F-6ACA1D440402-3','22534609823'],
['38A219F7-294B-410F-949D-124CBD299BF4-3','2941779817 '],
['AFF93022-067A-4A4E-AC65-51D489A27915-4','22874017841'],
['F15C5DBF-6D3D-4E96-AD61-FA50F37ECC16-3','6420754844 '],
['6811F73C-66D2-49BC-ABFA-1313B2A97EF8-4','22874017841'],
['BC035DDB-D2ED-401C-BC4A-5E263F350DAD-3','6327080855 '],
['0473797E-779F-4E47-A304-E98F7BED8D06-4','1085128865 '],
['474F8B21-967F-4997-9A62-E881FF9D1E29-4','89802616834'],
['F01A1A6E-AD0B-4D01-8F5F-3399B6F12E6F-5','69482039653'],
['1ACD72B6-92FE-41BC-BA12-965F58230C1E-4','10815911882']
];

include_once '../_system/_functionsMain.php';
$Contemp=connTemp(306, '');
foreach ($array as $key => $dados)
{
    $xml = "select * from origemvenda where cod_pdv='".$dados[0]."'"; 
    $rs = mysqli_query($Contemp, $xml);

    // Verificando se a query foi executada corretamente
    if (!$rs) {
        echo "Erro na query: " . mysqli_error($Contemp);
    } else {
        $rsw = mysqli_fetch_assoc($rs);
        $xmlString = mb_convert_encoding($rsw['DES_VENDA'], 'UTF-8', 'auto');        
        $xml = new SimpleXMLElement($xmlString);
        // Navegar até o nó <id_vendapdv> e adicionar o sufixo '_repro'
        $pdv=$xml->xpath('//id_vendapdv')[0][0];

       $xmlest='<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:fid="fidelidade">
				   <soapenv:Header/>
				   <soapenv:Body>
					  <fid:EstornaVenda>
						 <fase>fase1</fase>
						 <id_vendapdv>'.$pdv.'</id_vendapdv>
						 <dadosLogin>
							<login>'.$xml->xpath('///login')[0][0].'</login>
							<senha>'.$xml->xpath('///senha')[0][0].'</senha>
							<idloja>'.$xml->xpath('///idloja')[0][0].'</idloja>
							<idcliente>'.$xml->xpath('///idcliente')[0][0].'</idcliente>
						 </dadosLogin>
                                      </fid:EstornaVenda>
				   </soapenv:Body>
				</soapenv:Envelope>';
        
   
      
        /*$xml->xpath('//cartao')[0][0]=rtrim(trim($dados['1']));
        $fp=$xml->xpath('//formapagamento')[0][0];
        $formapagamento_utf8= html_entity_decode($fp, ENT_QUOTES, 'UTF-8');        
        $xml->xpath('//formapagamento')[0][0] = $formapagamento_utf8;
        // Exibir o XML modificado
       $xmlrep= $xml->asXML();*/
        
        
        $curl = curl_init();
            curl_setopt_array($curl, array(
              CURLOPT_URL => "http://soap.bunker.mk/?wsdl",
              CURLOPT_RETURNTRANSFER => true,
              CURLOPT_ENCODING => "",
              CURLOPT_MAXREDIRS => 0,
              CURLOPT_TIMEOUT => 0,
              CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
              CURLOPT_CUSTOMREQUEST => "POST",
              CURLOPT_POSTFIELDS => $xmlest,
              CURLOPT_HTTPHEADER => array(
                "cache-control: no-cache",
                "content-type: text/xml"
              ),
            ));

            $response = curl_exec($curl);
            $err = curl_error($curl);

            curl_close($curl);

            if ($err) {
             echo "cURL Error #:" . $err;


            } else {         
             
          $doc = new DOMDocument();
          libxml_use_internal_errors(true);
          $doc->loadHTML($response);
          libxml_clear_errors();
          $xml1 = $doc->saveXML($doc->documentElement);
        
            $xml1 = simplexml_load_string($xml1,'SimpleXMLElement',LIBXML_NOCDATA);
            $json = json_encode($xml1);
            $array1 = json_decode($json,TRUE);
            echo '<pre>';
            print_r($array1);
            echo '<pre>';
           
   
            }
    }
}    



